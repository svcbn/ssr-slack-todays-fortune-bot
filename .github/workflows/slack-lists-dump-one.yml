name: Slack Lists - List accessible lists (debug)

on:
  workflow_dispatch:

jobs:
  list:
    runs-on: ubuntu-latest
    steps:
      - name: List lists visible to bot
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
        run: |
          set -euo pipefail
          python3 - << 'PY'
          import os, json, urllib.request

          token = os.environ["SLACK_BOT_TOKEN"]

          def post(method: str, payload: dict):
              url = f"https://slack.com/api/{method}"
              data = json.dumps(payload).encode("utf-8")
              req = urllib.request.Request(url, data=data, method="POST")
              req.add_header("Authorization", f"Bearer {token}")
              req.add_header("Content-Type", "application/json; charset=utf-8")
              with urllib.request.urlopen(req, timeout=30) as resp:
                  body = resp.read().decode("utf-8")
              return json.loads(body)

          print("=== slackLists.lists.list ===")
          res = post("slackLists.lists.list", {"limit": 50})
          print(json.dumps(res, ensure_ascii=False, indent=2)[:8000])
          PY
